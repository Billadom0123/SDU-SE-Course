# 接口测试

Created by: 我杀了一只猩猩
Created time: September 1, 2023 2:21 PM
Tags: Engineering, Guides

本接口测试采用的工具为Postman。官网地址:[Postman API Platform | Sign Up for Free](https://www.postman.com/)

Postman最新版本提供了webSocket连接的接口，这也是我选择该应用作为接口测试工具的原因之一。

## 0. 测试目标

一个司机和一个乘客登陆，完成核心业务流程中除了乘客提交评价的任何接口的测试。

核心业务流程具体参照系统演示文档。

## 1.环境准备

1. 下载安装Postman软件，注册账户并登陆，创建所需的connection文件
2. 可以通过sql脚本，也可以通过客户端，或者可以通过Postman本身向负责注册业务的接口发送请求。总之，注册一个司机和一个乘客。
3. 通过客户端或Postman向负责登陆业务的接口发送请求。总之，获取这两个账号登陆的token。
4. 在Postman中所有需要鉴权的接口的Header中添加请求头字段`authorization:${token}`

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled.png)

1. 确保服务端处于运行状态

## 2. 测试流程

### 2.1 建立WebSocket连接

向服务端的指定路径分别建立与司机、乘客客户端（Postman模拟)的ws连接。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%201.png)

服务端我配置了控制台日志，可以看到用户已经连接上了。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%202.png)

### 2.2 乘客用户发起约车请求

你可以自己创建这个文件，或者导入我附录中的文件。请求的参数可以自己修改。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%203.png)

发出请求后，获得带有请求id的响应。请注意保留这个请求id，这是为了测试后续的接口。

### 2.3 司机开始听单

参数可以自己修改

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%204.png)

由于当前系统中只有这一个刚开始听单的空闲司机，于是刚刚发出的约车请求一定会派发给该司机。

我们回到ws的连接中查看，果然，分配给了该司机。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%205.png)

随后，控制台的日志中也打印了将订单分配给该司机的过程。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%206.png)

### 2.4 司机接受订单

把ws中的请求id复制到这个测试文件中的requestId参数中。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%207.png)

回到乘客的ws连接中，发现已经将司机和车辆信息发送给了乘客客户端

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%208.png)

### 2.5 司机接到乘客

把请求id复制到reqId字段中。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%209.png)

这个环节的业务比较简单，我就没有在控制台打日志。

### 2.6 司机到达目的地后提交订单

把请求id复制到reqId字段中。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%2010.png)

在服务端控制台我打印了日志，至此，该订单结束。

![Untitled](%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%204da6ab7679f44509abb33fcbb0684358/Untitled%2011.png)

注：如果你想测试别的接口，请自己编写测试文件，系统庞大、接口繁杂，我在有限的时间内仅凭一个人很难完成所有测试工作。